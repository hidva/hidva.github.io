---
title: "分布式存储的一些经验和 zp 的设计考虑"
tags: [读后感, 分布式存储]
---


>   我一直觉得不同的场景需要有不同的存储系统去解决, 有在线存储的需求, 有离线存储的需求. 因此肯定不是一套存储系统能够通吃所有的场景(不过貌似spanner 在做这个事情)

spanner 这么弔? 能用作 TSDB 么?!


# 离线存储

离线存储的需求, 参见原文了解.

# 在线存储

在线存储的各种场景以及对应的解决方案, 参见原文长个见识.


>   当然不同的接口实现难度还是不太一样, 比如实现SQL接口, POSIX文件系统接口, 图数据库肯定要比实现一个对象存储的接口要容易很多

真的么, 我怎么觉得应该反过来?

>    如果存储的是稍微偏冷的数据, 一定是EC编码, 然后存在大的机械盘. 对于线上比较热的数据, 延迟要求比较高. 一定是3副本, 存在SSD盘上.

Facebook, Google 存储技术栈了解一下.

Ceph, Google F1 实现结构, 参见原文了解. 另外这种一层套一层的实现是如何保障最顶层的性能呢?

作者认为的存储层次, 参见原文了解一下, 主要是存储最底层应该是 Block storage, 然后再次之上搭建 kv 等. 所以 zeppelin 定位的是高可用, 高性能, 可定制一致性的 block storage 服务. 有些道理, 只是我感觉分布式 kv 是基础最常用的存储系统, 如果其底层在套个分布式 block storage 是不是影响其性能? 所以我觉得 block storage, kv storage 都应该是最底层存储.

>   还有一个原因是我们所说的key-value store 更多偏向于里面的内容是没有关系的, 而在zeppelin 提供给s3 使用的场景里面, 这些key-value 是有关系的, 所以我更倾向于说目前的存储的架构是: 底层提供block store, 然后上层基于各个接口实现不同的封装

按我理解, 如果基于 kv 实现 blob storage 那么 kv 内的内容是有关联的, 即很多场景下某个 key 对应的 value 中存放着其他数据的 key 取值. 但由于 kv 存储在实现时假设 kv 内容没有联系, 所以没有做相应的优化.

# 中心节点设计

>   有中心节点优点是简单, 清晰, 更新及时, 可扩展性强. 缺点是存在单点故障
>   无中心节点优点是无单点故障, 水平扩展能力强. 缺点是消息传播慢, 限制集群规模等等

这里有点逗, [SERF中去中心化系统的原理和实现]({{site.url}}/2018/03/14/serf/) 提到

>   去中心化系统更多的是面向大规模分布式平台，当集群规模增加到数万甚至数十万节点时，主从模型的信息传播给节点和网络都会带来不小的负载，集群状态管理的效率和正确性也会随着规模的增大而下降，这就是为什么很多基于“主－从”模型的中心化系统都有集群规模的上限。

不过可能是两位大佬看待的角度不一样吧.

zeppelin 采用有中心化设计, 但也操作大量的优化去尽可能避免中心节点的压力; 如: Client 缓存大量元信息, 只有 Client 出错是才又访问 Meta Server 获取最新元信息; 这里 client 出错是因为 client 使用了过期的元信息访问了错误的节点等; 所以这意味着在 node server 侧要进行一些判断处理这种情况.


# 数据分布

zeppelin 数据分布, 参见原文了解. [浅谈分布式存储系统数据分布方法]({{site.url}}/2018/03/14/datahash/)中有更详细的介绍.



# 参考

-   [关于我做存储的一些经验和zp 的设计考虑][20180316105558]


[20180316105558]: <https://mp.weixin.qq.com/s?__biz=MzIyNjE4NjI2Nw==&mid=2652560211&idx=1&sn=46b11ada9bbbde8e38e2aa081ebb870d&scene=21#wechat_redirect> "发布日期: 2018-02-15"

