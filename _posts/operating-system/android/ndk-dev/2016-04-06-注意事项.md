---
title: Android NDK 开发中的注意事项
tags: ["Android NDK"]
---

## 不要将 C++ runtime 静态链接到多个 binary 中!

*   在 Android NDK 官方文档中指明了 Linking the static library variant of a C++ runtime
    to more than one binary may result in unexpected behaviors:

    -   Exceptions raised in libfoo.so going uncaught in libbar.so, causing your
        app to crash.
    -   Memory allocated in one library, and freed in the other, causing memory
        leakage or heap corruption.
    -   Buffering of std::cout not working properly

*   其实当初也是系统看 Android NDK 文档时扫到了,也从来没使用过 static C++ runtime,所以也没
    遇到过 unexpected behaviors;但是直到有一天使用了第三方 prebuilt 库,然后该库将 C++ runtime
    static 了!然后就遇到了 libfoo.so 抛出的异常被 libbar.so 捕获,然后 crash!倒是想了一会才
    想起来这个情况.. T_T

## Android Sdcard

*   Android 上,SDCARD 通常采用 FAT32 文件系统.而且在 FAT32 文件系统中,没有 inode 概念;
    Android 上 Linux 内核会在在 SDCARD 上创建一个新文件时,为其生成一个随机的 inode 值;但
    是该 inode 在某些情况(如设备重启)下会丢失;在 FAT32 上,文件与文件路径是一一对应的;因此可
    以使用文件路径(或其 HASH)来表示文件.



**转载请注明出处!谢谢**
