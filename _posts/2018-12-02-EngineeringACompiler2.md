---
title: 编译器设计读书笔记-2
subtitle: "可能对你并没有什么用的"
tags: [读后感]
---

# 第 4 章 上下文相关分析

老规矩, 先来看一堆概念.

上下文相关分析, 又称语义推敲, 按我理解, 就和之前的词法分析, 语法分析一样, 上下文相关分析也是编译器的一趟处理; 在这里, 编译器会收集更多与源代码相关的信息, 并基于这些信息做一些处理, 比如来判断源程序是否符合语义; 毕竟语法分析通过只是意味着源程序符合语法, 并不意味着源程序符合语义, 如在 C 语言中, 但从语法角度来看, 代码片段: `"hidva.com" + 33` 是符合表达式语法的, 是能通过语法分析的, 但是很显然不符合语义, 无法通过语义检查. 

属性语法; 属性语法是用来进行上下文相关分析的一种机制, 属性语法更像是学术界搞出来的玩意儿, 在现实世界的编译器中很少会使用属性语法来进行上下文相关分析的. 属性语法就是属性化的上下文无关语法, 等同于上下文无关语法加上一些属性规则. 这些规则与特定的产生式关联, 为产生式中特定的符号定义了属性以及属性的取值. 这里的属性是指, 如果把产生式中语法符号视为一个对象的, 属性就是指对象的数据成员. 规则在定义语法符号属性的取值时可能会使用其他语法符号某些属性的值, 此时就建立了一种依赖关系(又称定义了一个依赖项), 描述起来就是语法符号 A 的属性 i A.i 依赖语法符号 B 的属性 j B.j; 所有规则定义的依赖项会形成属性依赖关系图. 在不存在循环依赖的情况下, 属性依赖关系图会是一个 DAG, 若属性依赖关系图中存在环, 则表明存在循环依赖的情况, 此时属性语法认为是病态的. 综合属性, 继承属性, 其定义参见原文. 

属性语法的求值; 在编译器完成语法分析生成语法分析树后, 为树中每一个必要的节点创建一个属性实例, 存放着属性规则为该符号定义的属性, 此时在属性实例中, 属性的取值尚未被确定. 然后根据属性依赖关系图定义的依赖关系开始逐一地对属性进行求值.

特设语法制导转换; 也是用来进行上下文相关分析的一种机制, 而且也是现实世界的编译器常用的一种操作, ~~如此拗口的名字是怎么起出来的!~~. 其大致形式就是定义一组与特定产生式关联的操作, 然后在语法分析器完成对相关产生式的归约之后执行相关的操作, 就像是为每一个产生式都定义一个类似 OnXXX 的 callback, 然后语法分析器在完成归约之后会调用该 callback. 

特设语法制导转换中操作之间值是如何传递的? 参见原文图 4-11, 这其中值 val 是如何传递的呢? 在属性语法中, 通过将属性保存在语法分析树的节点中来在属性规则之间进行值的传递. 而在特设语法制导转换中, 语法分析树一般不会显式构建, 所以只能将值保存在语法分析器的内部栈之中, 并以此来实现在操作之间值的传递, 具体操作参考原文. 值的引用, 在产生式关联的操作之中, 通过 $$$_i$$ 来引用第 i 个右侧符号对应的值, 会将符号 $$ 的取值作为产生式左侧符号对应的值压入栈中.

如果想要在每次移进时也执行指定的 callback 该咋整? 根据上面的介绍, callback 只能在归约一个产生式时执行, 所以如果想要在每次移进时都执行 callback, 具体姿势参见原文.

# 后语

未完待续...
