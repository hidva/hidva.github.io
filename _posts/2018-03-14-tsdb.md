---
title: 时序数据库
tags: [读后感, TSDB]
---


## 为万物互联插上一双翅膀

参见原文简单了解一下时序数据库的使用场景; 参见原文举得例子了解时序数据长个什么样.

### 时序业务有哪些特点

参见原文. 按我理解可以使用 mysql 来充当 tsdb; 但是不能充分发挥出性能, 比如说目测 tsdb 使用场景是写多读少, 所以基于 lsm 存储引擎实现的 db 性能应该会更好.

### TSDB关注的核心技术点在哪里

参见原文.

>   比如最近3小时的数据是1T，我现在只有100G的内存，如果不压缩，就会有900G的数据被迫放到硬盘上，这样的话查询开销会非常之大，而使用压缩会将这1T数据都放入内存，查询性能会非常之好。

-   QA: 大哥你可以直接查找压缩数据么?!
-   A: 按我理解这里的压缩方式可能是 rocksdb 对 key 使用的增量压缩方式. 比如可以把时序数据按小时压缩, 一个小时区间内仅对这个小时内第一条记录完整存放, 这个小时区间内后续记录将仅存放与上一个记录的差值. 而且时序数据库的读取场景一般是指定时间段读取, 所以可以在读取时边读取边解压.

多维度查询能力. 按我理解 tsdb 中一条记录除了时间戳之外还有各种 id, 每一个 id 标示着一个实体, 表示一个维度. 如原文举的点击率例子: google.com, USA 等都是实体的 id, 比如可能存在一个地域表可以根据 USA 这个 id 来查找 USA 相关的一些信息. 多维查询也参见这个例子, 多维查询的高效实现: 倒排, 位图等.

高效聚合能力. 如何实现? 本来我想的是以时间戳为 B 树主键, 但是意识到根据之前内容 tsdb 适合采用 leveldb 这类引擎. 原文给的答案是预聚合, 预聚合能解决的场景应该较窄吧.


## 时序数据存储模型设计

参见原文了解时序数据库的一些概念.

### OpenTSDB(HBase)时序数据存储模型

参见原文, 首先介绍了 opentsdb 大概是如何基于 hbase 实现的; 然后这套实现的缺点然后以及 opentsdb 采用的优化方案.

hbase 不是很了解, 暂且视为类似 bigtable 的分布式表格数据库吧.

opentsdb rowkey 中的 metric 是指一个指标名比如点击率等, 而不是指标的具体值, 指标的具体值作为 value 部分存放在 hbase 中.

### Druid时序数据存储模型设计

简单的介绍了 Druid 以及如何利用 druid 实现时序数据库的, 以及相应的优缺点, 参见原文了解.

>   指定数据源的范围查找并没有OpenTSDB高效。

按我理解这个应该仅在某些场景下吧, 比如当我们选取的 data source 并不位于 rowkey 的前缀或后缀时并不能充分利用出 b 树索引的性能吧? 这时应该还是 Druid 更胜一筹吧?

### InfluxDB时序数据存储模型设计

参见原文, 主要介绍了 influxdb 这款**专业**时序数据库的大致结构.

measurement 这个是啥没看懂, 感觉像是时序数据库的定义, 类似 SQL 的 create table 那种.

>   内存中的数据flush的文件后，同样会将同一个SeriesKey中的时间线数据写入同一个Block块内，即一个Block块内的数据都属于同一个数据源下的同一个field。

这里应该是 serieskey + field 下的数据会被写入同一个 block.

>   InfluxDB的这种存储引擎称为TSM，全称为Timestamp-Structure Merge Tree，基本原理类似于LSM。

这里可以品一品 'Timestamp-Structure', 'Merge', 'Tree' 的味道.

### Beringei时序数据存储模型设计

参见原文. 简单的介绍了 Beringei 这款时序数据库. 注意 Beringei 比 influxdb 的优点.






## 参考

-   [时序数据库－为万物互联插上一双翅膀][20180203183333]
-   [时序数据库技术体系－时序数据存储模型设计][20180203183441]


[20180203183333]: <http://hbasefly.com/2017/11/19/timeseries-database-1/> "网页剪报/时序数据库－为万物互联插上一双翅膀"

[20180203183441]: <http://hbasefly.com/2017/11/19/timeseries-database-2/> "网页剪报/时序数据库技术体系－时序数据存储模型设计"

